# This is a minimal example config
# See /usr/share/doc/lighttpd
# and http://redmine.lighttpd.net/projects/lighttpd/wiki/Docs:ConfigurationOptions

# {{{ Variables
server.tag              = ""
server.port		        = 7443
server.username		    = "http"
server.groupname	    = "http"
server.document-root	= "/srv/http"
server.pid-file		    = "/var/run/lighttpd/lighttpd.pid"
server.errorlog		    = "/var/log/lighttpd/error.log"
dir-listing.activate	= "disable"
index-file.names	    = ( "index.html", "index.php", "displatch.fcgi" )
# }}}

# {{{ Mimetypes
mimetype.assign		= (
    ".pdf"          =>  "application/pdf",
    ".sig"          =>      "application/pgp-signature",
    ".spl"          =>      "application/futuresplash",
    ".class"        =>      "application/octet-stream",
    ".ps"           =>      "application/postscript",
    ".torrent"      =>      "application/x-bittorrent",
    ".dvi"          =>      "application/x-dvi",
    ".gz"           =>      "application/x-gzip",
    ".pac"          =>      "application/x-ns-proxy-autoconfig",
    ".swf"          =>      "application/x-shockwave-flash",
    ".tar.gz"       =>      "application/x-tgz",
    ".tgz"          =>      "application/x-tgz",
    ".tar"          =>      "application/x-tar",
    ".zip"          =>      "application/zip",
    ".mp3"          =>      "audio/mpeg",
    ".m3u"          =>      "audio/x-mpegurl",
    ".wma"          =>      "audio/x-ms-wma",
    ".wax"          =>      "audio/x-ms-wax",
    ".ogg"          =>      "application/ogg",
    ".wav"          =>      "audio/x-wav",
    ".gif"          =>      "image/gif",
    ".jpg"          =>      "image/jpeg",
    ".jpeg"         =>      "image/jpeg",
    ".png"          =>      "image/png",
    ".xbm"          =>      "image/x-xbitmap",
    ".xpm"          =>      "image/x-xpixmap",
    ".xwd"          =>      "image/x-xwindowdump",
    ".css"          =>      "text/css",
    ".html"         =>      "text/html",
    ".htm"          =>      "text/html",
    ".js"           =>      "text/javascript",
    ".asc"          =>      "text/plain; charset=utf8",
    ".c"            =>      "text/plain; charset=utf8",
    ".cpp"          =>      "text/plain; charset=utf8",
    ".log"          =>      "text/plain; charset=utf8",
    ".conf"         =>      "text/plain; charset=utf8",
    ".text"         =>      "text/plain; charset=utf8",
    ".txt"          =>      "text/plain; charset=utf8",
    ".dtd"          =>      "text/xml",
    ".xml"          =>      "text/xml",
    ".mpeg"         =>      "video/mpeg",
    ".mpg"          =>      "video/mpeg",
    ".mov"          =>      "video/quicktime",
    ".qt"           =>      "video/quicktime",
    ".avi"          =>      "video/x-msvideo",
    ".asf"          =>      "video/x-ms-asf",
    ".asx"          =>      "video/x-ms-asf",
    ".wmv"          =>      "video/x-ms-wmv",
    ".bz2"          =>      "application/x-bzip",
    ".tbz"          =>      "application/x-bzip-compressed-tar",
    ".tar.bz2"      =>      "application/x-bzip-compressed-tar"
)
# }}}

# {{{ Modules
server.modules = (
    "mod_access",
    "mod_alias",
    "mod_cgi",
    "mod_fastcgi",
    "mod_accesslog",
    "mod_evasive",
    "mod_setenv",
    "mod_redirect",
    "mod_rewrite",
    "mod_proxy",
    "mod_scgi",
#                               "mod_cml",
#                               "mod_trigger_b4_dl",
#                               "mod_auth",
#                               "mod_status",
#                               "mod_simple_vhost",
#                               "mod_evhost",
#                               "mod_userdir",
#                               "mod_compress",
#                               "mod_ssi",
#                               "mod_usertrack",
#                               "mod_expire",
#                               "mod_secdownload",
#                               "mod_rrdtool",
)
# }}}

# {{{ Mod Evasive
evasive.max-conns-per-ip = 20
# }}}

# {{{ FastCGI and PHP
server.error-handler-404   = "/dispatch.fcgi" #too
fastcgi.server = (
".php" =>
  ( "localhost" =>
    (
      "socket" => "/tmp/php-fastcgi.socket",
      "bin-path" => "/usr/bin/php-cgi"
    )
  )
)
# }}}

# {{{ SSL
ssl.engine = "enable" 
ssl.pemfile = "/etc/lighttpd/server.pem"

$SERVER["socket"] == ":80" {
   ssl.engine = "disable"
}
# }}}

# {{{ Authentication
auth.backend = "htdigest"
auth.backend.htdigest.userfile = "/etc/lighttpd/passwd"
auth.debug = 2

auth.require = ("/awstats/" => (
    "method" => "digest",
    "realm" => "admins",
    "require" => "valid-user"
))
# }}}

# {{{ PHPMyAdmin
$HTTP["host"] =~ "sql\.twyk\.tk" {
    server.document-root    = "/usr/share/webapps/phpMyAdmin/"
    accesslog.filename      = "/var/log/lighttpd/sql.twyk.tk.log"
}
# }}}

#{{{ CouchDB
$HTTP["host"] =~ "db\.twyk\.tk" {
    proxy.server        = ("" => ("localhost" => ("host" => "127.0.0.1", "port" => 5984)))
    accesslog.filename  = "/var/log/lighttpd/db.twyk.tk.log"
}
#}}}

# {{{ Tiny Tiny RSS
$HTTP["host"] =~ "news\.twyk\.tk" {
    server.document-root    = "/home/http/ttrss/"
    accesslog.filename      = "/var/log/lighttpd/news.twyk.tk.log"
}
# }}}

# {{{ Streeme
# $SERVER["socket"] == ":443" {
#     #ssl.engine           = "disable"
#     server.document-root = "/srv/http/streeme/web"
#     alias.url           += (
#         "/sf" => "/lib/vendor/symfony/data/web/sf"
#     )
#     url.rewrite-once = ( 
#             "^/(.*\..+(?!html))$" => "$0",
#             "^/(.*)\.(.*)"        => "$0",
#             "^/([^.]+)$"          => "/index.php/$1",
#             "^/$"                 => "/index.php"
#     )
# }

# $SERVER["socket"] == ":80" {
#     ssl.engine           = "disable"
#     server.document-root = "/srv/http/streeme/web"
#     alias.url           += (
#         "/sf" => "/lib/vendor/symfony/data/web/sf"
#     )
#     url.rewrite-once = ( 
#         "^/(.*\..+(?!html))$" => "$0",
#         "^/(.*)\.(.*)"        => "$0",
#         "^/([^.]+)$"          => "/index.php/$1",
#         "^/$"                 => "/index.php"
#     )
# }
# }}}

# {{{ Gitweb
$HTTP["host"] =~ "git\.twyk\.tk" {
    server.document-root    = "/usr/share/gitweb/"
    accesslog.filename      = "/var/log/lighttpd/git.twyk.tk.log"
    cgi.assign              = (".cgi" => "")
    server.indexfiles       = ("gitweb.cgi")
    setenv.add-environment  = ( "GITWEB_CONFIG" => "/etc/conf.d/gitweb.conf" )
}
# }}}

# {{{ OpenID
$HTTP["host"] =~ "id\.twyk\.tk" {
    server.document-root    = "/home/http/openid/www/"
    accesslog.filename      = "/var/log/lighttpd/id.twyk.tk.log"
}
# }}}

# {{{ Monit
$HTTP["host"] =~ "status\.twyk\.tk" {
    proxy.server        = ("" => ("localhost" => ("host" => "127.0.0.1", "port" => 2812)))
    accesslog.filename  = "/var/log/lighttpd/status.twyk.tk.log"
}
# }}}

# {{{ Cups
$HTTP["host"] =~ "print\.twyk\.tk" {
    proxy.server        = ("" => ("print.twyk.tk" => ("host" => "127.0.0.1", "port" => 631)))
    accesslog.filename  = "/var/log/lighttpd/print.twyk.tk.log"
}
# }}}

# {{{ RuTorrent
scgi.server = (
    "/RPC2" => (
        "127.0.0.1" => (
            "host" => "127.0.0.1",
            "port" => 5000,
            "check-local" => "disable"
        )
    )
)
# }}}

# {{{ RSSLounge
url.rewrite-once += (
    "^/rsslounge/favicon.ico$" => "/rsslounge/public/favicon.ico",
    "^/rsslounge/plugins/([^/]+)/(.*)$" => "/rsslounge/plugins/$1/public/$2",
    "^/rsslounge/favicons/(.*)$" => "/rsslounge/data/favicons/$1",
    "^/rsslounge/thumbnails/(.*)$" => "/rsslounge/data/thumbnails/$1",
    "^/rsslounge/javascript/(.*)$" => "/rsslounge/public/javascript/$1",
    "^/rsslounge/stylesheets/(.*)$" => "/rsslounge/public/stylesheets/$1",
    "^/rsslounge/public/" => "$0",
    "^/rsslounge/(.*)" => "/rsslounge/index.php?mod_rewrite=1&$1"
)
# }}}

# {{{ 10er10
$HTTP["host"] =~ "music\.twyk\.tk" {
    proxy.server        = ("" => ("localhost" => ("host" => "127.0.0.1", "port" => 8888)))
    accesslog.filename  = "/var/log/lighttpd/music.twyk.tk.log"
}
# }}}

# {{{ Awstats
$HTTP["host"] =~ "stats\.twyk\.tk" {
    cgi.assign = (
        ".pl" => "/usr/bin/perl",
        ".cgi" => "/usr/bin/perl"
    )
    server.document-root = "/srv/http/awstats/"
}
