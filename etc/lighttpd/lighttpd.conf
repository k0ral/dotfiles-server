# {{{ Variables
server.tag              = ""
server.port		        = 7443
server.username		    = "http"
server.groupname	    = "http"
server.document-root	= "/srv/http"
server.pid-file		    = "/var/run/lighttpd/lighttpd.pid"
server.errorlog		    = "/var/log/lighttpd/error.log"
dir-listing.activate	= "disable"
index-file.names	    = ( "index.html", "index.php", "dispatch.fcgi" )
# }}}

# {{{ Mimetypes
mimetype.assign	= (
    ".pdf"          =>  "application/pdf",
    ".sig"          =>  "application/pgp-signature",
    ".spl"          =>  "application/futuresplash",
    ".class"        =>  "application/octet-stream",
    ".ps"           =>  "application/postscript",
    ".torrent"      =>  "application/x-bittorrent",
    ".dvi"          =>  "application/x-dvi",
    ".gz"           =>  "application/x-gzip",
    ".pac"          =>  "application/x-ns-proxy-autoconfig",
    ".swf"          =>  "application/x-shockwave-flash",
    ".tar.gz"       =>  "application/x-tgz",
    ".tgz"          =>  "application/x-tgz",
    ".tar"          =>  "application/x-tar",
    ".zip"          =>  "application/zip",
    ".mp3"          =>  "audio/mpeg",
    ".m3u"          =>  "audio/x-mpegurl",
    ".wma"          =>  "audio/x-ms-wma",
    ".wax"          =>  "audio/x-ms-wax",
    ".ogg"          =>  "application/ogg",
    ".wav"          =>  "audio/x-wav",
    ".gif"          =>  "image/gif",
    ".jpg"          =>  "image/jpeg",
    ".jpeg"         =>  "image/jpeg",
    ".png"          =>  "image/png",
    ".xbm"          =>  "image/x-xbitmap",
    ".xpm"          =>  "image/x-xpixmap",
    ".xwd"          =>  "image/x-xwindowdump",
    ".css"          =>  "text/css",
    ".html"         =>  "text/html",
    ".htm"          =>  "text/html",
    ".js"           =>  "text/javascript",
    ".asc"          =>  "text/plain; charset=utf8",
    ".c"            =>  "text/plain; charset=utf8",
    ".cpp"          =>  "text/plain; charset=utf8",
    ".log"          =>  "text/plain; charset=utf8",
    ".conf"         =>  "text/plain; charset=utf8",
    ".text"         =>  "text/plain; charset=utf8",
    ".txt"          =>  "text/plain; charset=utf8",
    ".dtd"          =>  "text/xml",
    ".xml"          =>  "text/xml",
    ".mpeg"         =>  "video/mpeg",
    ".mpg"          =>  "video/mpeg",
    ".mov"          =>  "video/quicktime",
    ".qt"           =>  "video/quicktime",
    ".avi"          =>  "video/x-msvideo",
    ".asf"          =>  "video/x-ms-asf",
    ".asx"          =>  "video/x-ms-asf",
    ".wmv"          =>  "video/x-ms-wmv",
    ".bz2"          =>  "application/x-bzip",
    ".tbz"          =>  "application/x-bzip-compressed-tar",
    ".tar.bz2"      =>  "application/x-bzip-compressed-tar"
)
# }}}

# {{{ Modules
server.modules = (
    "mod_access",
    "mod_alias",
    "mod_auth",
    "mod_cgi",
    "mod_expire",
    "mod_fastcgi",
    "mod_accesslog",
    "mod_evasive",
    "mod_setenv",
    "mod_redirect",
    "mod_rewrite",
    "mod_proxy",
    "mod_scgi",
#   "mod_cml",
#   "mod_trigger_b4_dl",
#   "mod_status",
#   "mod_simple_vhost",
#   "mod_evhost",
#   "mod_userdir",
#   "mod_compress",
#   "mod_ssi",
#   "mod_usertrack",
#   "mod_secdownload",
#   "mod_rrdtool",
)
# }}}

# {{{ Mod Evasive
evasive.max-conns-per-ip = 20
# }}}

# {{{ FastCGI
server.error-handler-404   = "/dispatch.fcgi" #too
fastcgi.debug = 1
fastcgi.map-extensions = ( ".php3" => ".php", ".php4" => ".php" )
fastcgi.server = (
    ".php" => ("localhost" => (
        "socket" => "/tmp/php-fastcgi.socket",
        "bin-path" => "/usr/bin/php-cgi"
    ))
)
# }}}

# {{{ SSL
ssl.engine = "enable" 
ssl.pemfile = "/etc/lighttpd/server.pem"

$SERVER["socket"] == ":80" {
   ssl.engine = "disable"
}
# }}}

# {{{ Authentication
auth.backend = "htdigest"
auth.backend.htdigest.userfile = "/etc/lighttpd/passwd"
auth.debug = 2
# }}}

# {{{ PHPMyAdmin
#$HTTP["host"] =~ "phpmyadmin\.twyk\.org" {
#    server.document-root    = "/usr/share/webapps/phpMyAdmin/"
#    accesslog.filename      = "/var/log/lighttpd/phpmyadmin.log"
#}
# }}}

# {{{ Roundcube
$HTTP["host"] =~ "roundcube\.twyk\.org" {
    server.document-root    = "/usr/share/webapps/roundcubemail/"
    accesslog.filename      = "/var/log/lighttpd/roundcube.log"
}
# }}}

#{{{ CouchDB
#$HTTP["host"] =~ "couchdb\.twyk\.org" {
#    proxy.server        = ("" => ("localhost" => ("host" => "127.0.0.1", "port" => 5984)))
#    accesslog.filename  = "/var/log/lighttpd/couchdb.log"
#}
#}}}

# {{{ RSS lounge
$HTTP["host"] =~ "rsslounge\.twyk\.org" {
    server.document-root    = "/usr/share/webapps/rsslounge/"
    accesslog.filename      = "/var/log/lighttpd/rsslounge.log"

    url.rewrite-once += (
        "^/favicon.ico$" => "/public/favicon.ico",
        "^/plugins/([^/]+)/(.*)$" => "/plugins/$1/public/$2",
        "^/favicons/(.*)$" => "/data/favicons/$1",
        "^/thumbnails/(.*)$" => "/data/thumbnails/$1",
        "^/javascript/(.*)$" => "/public/javascript/$1",
        "^/stylesheets/(.*)$" => "/public/stylesheets/$1",
        "^/public/" => "/$0",
        "^/(.*)" => "/index.php?mod_rewrite=1&$1"
    )
}
# }}}

# {{{ Gitweb
# $HTTP["host"] =~ "git\.twyk\.tk" {
#     server.document-root    = "/usr/share/gitweb/"
#     accesslog.filename      = "/var/log/lighttpd/git.twyk.tk.log"
#     cgi.assign              = (".cgi" => "")
#     server.indexfiles       = ("gitweb.cgi")
#     setenv.add-environment  = ( "GITWEB_CONFIG" => "/etc/conf.d/gitweb.conf" )
# }
# }}}

# {{{ CGit
$HTTP["host"] =~ "cgit\.twyk\.org" {
    alias.url += (
        "/css/"     => "/usr/share/webapps/cgit/",
        "/cgit.png" => "/usr/share/webapps/cgit/cgit.png"
    )
    server.document-root    = "/usr/lib/cgit/"
    accesslog.filename      = "/var/log/lighttpd/cgit.log"
    cgi.assign              = (".cgi" => "")
    server.indexfiles       = ("cgit.cgi")
}
# }}}

# {{{ OpenID
#$HTTP["host"] =~ "simpleid\.twyk\.org" {
#    server.document-root    = "/home/http/openid/www/"
#    accesslog.filename      = "/var/log/lighttpd/simpleid.log"
#}
# }}}

# {{{ Monit
$HTTP["host"] =~ "monit\.twyk\.org" {
    proxy.server        = ("" => ("localhost" => ("host" => "127.0.0.1", "port" => 2812)))
    accesslog.filename  = "/var/log/lighttpd/monit.log"
}
# }}}

# {{{ Cups
#$HTTP["host"] =~ "cups\.twyk\.org" {
#    proxy.server        = ("" => ("/cups/" => ("host" => "127.0.0.1", "port" => 631)))
#    accesslog.filename  = "/var/log/lighttpd/cups.log"
#}
# }}}


# {{{ Gervi
#$HTTP["host"] =~ "gervi\.twyk\.org" {
#    accesslog.filename = "/var/log/lighttpd/gervi.log"
#    #fastcgi.map-extensions = ("/" => ".html")
#    alias.url += ("/default.css" => "/usr/local/share/gervi-0.1.0/default.css")
#
#    fastcgi.server = (
#        "" => ("gervi.twyk.org" => (
#            "socket"        => "/tmp/gervi.socket",
#            "bin-path"      => "/usr/local/bin/gervi.fcgi",
#            "docroot"       => "/",
#            "check-local"   => "disable"
#        ))
#    )
#    #expire.url = ("" => "access 0 days")
#}
# }}}

#{{{ MPD
$HTTP["host"] =~ "mpd\.twyk\.org" {
    proxy.server        = ("" => ("localhost" => ("host" => "127.0.0.1", "port" => 8080)))
    accesslog.filename  = "/var/log/lighttpd/mpd.log"
}
#}}}
